var VERSION="0.361";var BUILD_REQUIRED=-1;var lang=lang||null;var isGuest=(window.location.pathname=="/gui/guest.html");var utWebUI={torrents:{},files:{},settings:{},props:{},labels:{_all_:0,_dls_:0,_com_:0,_act_:0,_iac_:0,_nlb_:0},customLabels:{},cacheID:0,torrentID:"",propID:"",trtTable:new dxSTable(),flsTable:new dxSTable(),timer:0,updateTimeout:null,interval:-1,totalDL:0,totalUL:0,loaded:false,langLoaded:false,TOKEN:"",delActions:["remove","removedata"],init:function(){var A=(location.host.split(":"))[1];if(!$defined(A)){A=(window.location.protocol=="http:")?80:443}this.url=window.location.protocol+"//"+document.domain+":"+A+"/gui/";this.config={showDetails:true,showCategories:true,showToolbar:true,showTitleSpeed:false,updateInterval:3000,alternateRows:false,confirmDelete:true,lang:"en",hSplit:0.88,vSplit:0.5,trtCols:0,torrentTable:{reverse:false,maxRows:50,colOrder:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],colWidth:[220,100,80,80,100,80,60,80,80,60,80,60,60,60,30,90],sIndex:-1,rowsSelectable:!isGuest},flsCols:0,fileTable:{reverse:false,maxRows:50,colOrder:[0,1,2,3,4],colWidth:[200,60,80,100,80],sIndex:-1},activeLabel:"_all_"};if(isGuest){new Request({url:this.url+"token.html",method:"get",async:false,onSuccess:function(B){utWebUI.TOKEN=B.substring(B.indexOf("none;'>")+7,B.indexOf("</div>"))}}).send()}else{this.TOKEN=$("token").get("text");if(this.TOKEN.charAt(0)=="#"){this.TOKEN=""}}if(isGuest){this.addSettings();return }this.getSettings()},request:function(A,C,B){if(this.TOKEN!=""){A="token="+this.TOKEN+"&"+A}new Request.JSON({url:this.url+"?"+A+"&t="+$time(),method:"get",onSuccess:(C)?C.bind(this):$empty,async:!!B}).send()},perform:function(C){var B=this.getHashes(C);if(C=="pause"){var A=this.getHashes("unpause");if(A.length){this.request("action=unpause&hash="+A.join("&hash="))}}if(B.length==0){return }if(C.test(/^remove/)&&(B.indexOf(this.torrentID)>-1)){this.torrentID="";this.flsTable.clearRows();this.clearDetails()}this.getTorrents("action="+C+"&hash="+B.join("&hash="))},getHashes:function(B){var C=[];var A=this.trtTable.selectedRows.length;while(A--){var D=this.trtTable.selectedRows[A];var E=this.torrents[D][0];switch(B){case"forcestart":if((E&1)&&!(E&64)&&!(E&32)){continue}break;case"start":if((E&1)&&!(E&32)&&(E&64)){continue}break;case"pause":if(E&32){continue}break;case"unpause":if(!(E&32)){continue}break;case"stop":if(!(E&1)&&!(E&2)&&!(E&16)&&!(E&64)){continue}break;case"recheck":if(E&2){continue}break;case"remove":case"removedata":break;default:continue}C.push(D)}return C},forceStart:function(){this.perform("forcestart")},start:function(){this.perform("start")},pause:function(){this.perform("pause")},stop:function(){this.perform("stop")},remove:function(E){var C=this.trtTable.selectedRows.length;if(C==0){return }E=parseInt(E);if(isNaN(E)){E=(utWebUI.settings["gui.default_del_action"]<=1)?0:1}var B=!this.config.confirmDelete;if(!B){var A=(C!=1);var D=(E==0)?((A)?CONST.OV_CONFIRM_DELETE_MULTIPLE:CONST.OV_CONFIRM_DELETE_ONE):((A)?CONST.OV_CONFIRM_DELETEDATA_MULTIPLE:CONST.OV_CONFIRM_DELETEDATA_ONE);B=confirm(lang[D].replace(/%d/,C))}if(!B){return }this.perform(this.delActions[E])},recheck:function(){this.perform("recheck")},getTorrents:function(A){$clear(this.updateTimeout);this.timer=$time();A=A||"";if(A!=""){A+="&"}this.request(A+"list=1&cid="+this.cacheID,this.loadTorrents)},getStatusInfo:function(C,A){var B=["",""];if(C&CONST.STATE_STARTED){if(C&CONST.STATE_PAUSED){B=["Status_Paused",lang[CONST.OV_FL_PAUSED]]}else{B=[(A==1000)?"Status_Up":"Status_Down",(A==1000)?lang[CONST.OV_FL_SEEDING]:lang[CONST.OV_FL_DOWNLOADING]]}}else{if(C&CONST.STATE_CHECKING){B=[(C&CONST.STATE_PAUSED)?"Status_Paused":"Status_Checking",lang[CONST.OV_FL_CHECKED].replace(/%:\.1d%/,"??")]}else{if(C&CONST.STATE_ERROR){B=["Status_Error",lang[CONST.OV_FL_ERROR].replace(/%s/,"??")]}else{if(C&CONST.STATE_QUEUED){B=[(A==1000)?"Status_Queued_Up":"Status_Queued_Down",lang[CONST.OV_FL_QUEUED]]}}}}if(!(C&CONST.STATE_QUEUED)&&!(C&CONST.STATE_CHECKING)){B[1]="[F] "+B[1]}if((A==1000)&&(B[0]=="")){B=["Status_Completed",lang[CONST.OV_FL_FINISHED]]}else{if((A<1000)&&(B[0]=="")){B=["Status_Incompleted",lang[CONST.OV_FL_STOPPED]]}}return B},loadTorrents:function(O){var A=[];if(!has(O,"torrents")){A=O.torrentp;delete O.torrentp}else{A=O.torrents;delete O.torrents}this.loadLabels($A(O.label));delete O.label;if(!this.loaded){if(!has(this.labels,this.config.activeLabel)&&!has(this.customLabels,this.config.activeLabel)){this.config.activeLabel="_all_";$("_all_").addClass("sel");$(this.config.activeLabel).removeClass("sel")}else{$("_all_").removeClass("sel");$(this.config.activeLabel).addClass("sel")}}var B=this.trtTable.dBody.getScroll(),K=false;if(Browser.Engine.gecko||Browser.Engine.trident4){this.trtTable.detachBody()}for(var M=0,N=A.length;M<N;M++){var G=A[M];var C=G[CONST.TORRENT_HASH];var H=G[CONST.TORRENT_PROGRESS];var P=this.getStatusInfo(G[CONST.TORRENT_STATUS],H);this.totalDL+=G[CONST.TORRENT_DOWNSPEED];this.totalUL+=G[CONST.TORRENT_UPSPEED];G.swap(CONST.TORRENT_UPSPEED,CONST.TORRENT_DOWNSPEED);G.insertAt(P[1],3);if(!has(this.labels,C)){this.labels[C]=""}var Q=this.getLabels(C,G[12],H,G[9],G[10]),R=false,F=false;if(!has(this.torrents,C)){this.torrents[C]=G.slice(1);this.labels[C]=Q;G.splice(0,2);G[11]=G[11]+" ("+G[12]+")";G[12]=G[13]+" ("+G[14]+")";G[13]=G[15];G.splice(13,2);this.trtTable.addRow(G,C,P[0],(Q.indexOf(this.config.activeLabel)==-1));R=true}else{if(Q!=this.labels[C]){this.labels[C]=Q;if(Q.indexOf(this.config.activeLabel)>-1){if(this.trtTable.rowData[C].hidden){this.trtTable.rowData[C].hidden=false;F=true}}else{if(!this.trtTable.rowData[C].hidden){this.trtTable.rowData[C].hidden=true;F=true}}}var E=G.length-7;var D=this.torrents[C];if((D[0]!=G[1])||(D[3]!=G[4])){this.torrents[C][0]=G[1];this.trtTable.setIcon(C,P[0]);R=this.trtTable.setValue(C,1,P[1])}if((D[12]!=G[13])||(D[13]!=G[14])){this.torrents[C][12]=G[13];this.torrents[C][13]=G[14];R=this.trtTable.setValue(C,11,G[13]+" ("+G[14]+")")}if((D[14]!=G[15])||(D[15]!=G[16])){this.torrents[C][14]=G[15];this.torrents[C][15]=G[16];R=this.trtTable.setValue(C,12,G[15]+" ("+G[16]+")")}for(var L=16;L<20;L++){if(D[L]!=G[L+1]){this.torrents[C][L]=G[L+1];R=this.trtTable.setValue(C,L-3,G[L+1])}}for(var L=1;L<E;L++){if(D[L]!=G[L+1]){this.torrents[C][L]=G[L+1];R=this.trtTable.setValue(C,L-1,G[L+1])}}if(!R&&F){this.trtTable._insertRow(C)}}K=R||K;delete G}delete A;if(has(O,"torrentm")){var I=false;for(var M=0,L=O.torrentm.length;M<L;M++){var J=O.torrentm[M];delete this.torrents[J];if(this.labels[J].indexOf("_nlb_")>-1){this.labels._nlb_--}if(this.labels[J].indexOf("_com_")>-1){this.labels._com_--}if(this.labels[J].indexOf("_dls_")>-1){this.labels._dls_--}if(this.labels[J].indexOf("_act_")>-1){this.labels._act_--}if(this.labels[J].indexOf("_iac_")>-1){this.labels._iac_--}this.labels._all_--;delete this.labels[J];this.trtTable.removeRow(J);if(this.torrentID==J){I=true}}delete O.torrentm;if(I){this.torrentID="";this.flsTable.clearRows();this.clearDetails()}}if(!this.loaded&&(this.trtTable.sIndex>=0)){this.trtTable.sort()}else{if(this.trtTable.requiresRefresh||K){this.trtTable.refreshRows()}}if(Browser.Engine.gecko||Browser.Engine.trident4){this.trtTable.attachBody()}this.trtTable.dBody.scrollTo(B.x,B.y);this.trtTable.loadObj.hide();this.cacheID=O.torrentc;O=null;this.updateLabels();if(!this.loaded){this.loaded=true;this.trtTable.calcSize();$("cover").hide()}this.trtTable.refresh();this.updateTimeout=this.update.delay(this.getInterval(),this);this.updateDetails();this.updateSpeed()},updateSpeed:function(){var A=lang[CONST.MAIN_TITLEBAR_SPEED].replace(/%s/,this.totalDL.toFileSize()+perSec).replace(/%s/,this.totalUL.toFileSize()+perSec);window.status=window.defaultStatus=A.replace(/%s/,"");if(this.config.showTitleSpeed){document.title=A.replace(/%s/,"\u00B5Torrent WebUI v"+VERSION)}},update:function(){this.totalDL=0;this.totalUL=0;this.getTorrents()},getInterval:function(){var A=$time()-this.timer;this.interval=(this.interval==-1)?(this.config.updateInterval+A*4):((this.interval+this.config.updateInterval+A*4)/2).toInt();return this.interval},loadLabels:function(C){var K=$("lbll"),J={};for(var B=0,E=C.length;B<E;B++){var H=C[B][0],F="~"+H+"~",D=C[B][1],G=null;if(!(G=$(F))){G=new Element("li",{id:F}).addEvent("mousedown",function(){utWebUI.switchLabel(this)}).appendText(H+" (").grab(new Element("span",{id:"_"+F+"_c"}).set("text",D)).appendText(")");if(B==0){K.grab(G)}else{G.inject("~"+C[B-1][0]+"~","after")}}else{G.getFirst().set("text",D)}if(has(this.customLabels,F)){delete this.customLabels[F]}J[F]=D}var I=false;for(var A in this.customLabels){$(A).destroy();if(this.config.activeLabel==A){I=true}}this.customLabels=J;if(I){this.config.activeLabel="";this.switchLabel($("_all_"))}},getLabels:function(F,B,A,D,C){var E=[];if(B==""){E.push("_nlb_");if(this.labels[F].indexOf("_nlb_")==-1){this.labels._nlb_++}}else{E.push("~"+B+"~");if(this.labels[F].indexOf("_nlb_")>-1){this.labels._nlb_--}}if(A<1000){E.push("_dls_");if(this.labels[F].indexOf("_dls_")==-1){this.labels._dls_++}if(this.labels[F].indexOf("_com_")>-1){this.labels._com_--}}else{E.push("_com_");if(this.labels[F].indexOf("_com_")==-1){this.labels._com_++}if(this.labels[F].indexOf("_dls_")>-1){this.labels._dls_--}}if((D>103)||(C>103)){E.push("_act_");if(this.labels[F].indexOf("_act_")==-1){this.labels._act_++}if(this.labels[F].indexOf("_iac_")>-1){this.labels._iac_--}}else{E.push("_iac_");if(this.labels[F].indexOf("_iac_")==-1){this.labels._iac_++}if(this.labels[F].indexOf("_act_")>-1){this.labels._act_--}}E.push("_all_");if(this.labels[F]==""){this.labels._all_++}return E.join("")},setLabel:function(F){var C=[];for(var E=0,B=this.trtTable.selectedRows.length;E<B;E++){var D=this.trtTable.selectedRows[E];if(this.torrents[D][11]!=F){C.push(D)}}if(C.length>0){var A="&v="+encodeURIComponent(F)+"&s=label&hash=";this.request("action=setprops&s=label&hash="+C.join(A)+"&v="+encodeURIComponent(F))}},newLabel:function(){var A="";if(this.trtTable.selectedRows.length==1){A=this.torrents[this.trtTable.selectedRows[0]][11]}$("dlgLabel").centre().show();var B=$("txtLabel");B.set("value",(A=="")?lang[CONST.OV_NEW_LABEL]:A).focus();B.select()},createLabel:function(){this.setLabel($("txtLabel").get("value"))},updateLabels:function(){var A=this;["_all_","_dls_","_com_","_act_","_iac_","_nlb_"].each(function(B){$(B+"c").set("text",A.labels[B])})},switchLabel:function(C){if(C.id==this.config.activeLabel){return }if(this.config.activeLabel!=""){$(this.config.activeLabel).removeClass("sel")}C.addClass("sel");this.config.activeLabel=C.id;if(this.torrentID!=""){this.torrentID="";this.flsTable.clearRows();this.clearDetails()}var A=false;for(var B in this.torrents){if(this.labels[B].indexOf(this.config.activeLabel)>-1){if(this.trtTable.rowData[B].hidden){this.trtTable.unhideRow(B);A=true}}else{if(!this.trtTable.rowData[B].hidden){this.trtTable.hideRow(B);A=true}}}this.trtTable.clearSelection(true);this.trtTable.curPage=0;if(A){this.trtTable.refreshRows()}},getSettings:function(){var A="action=getsettings";if(!this.loaded){A+="&list=1";$clear(this.updateTimeout);this.timer=$time()}this.request(A,this.addSettings)},addSettings:function(I){if(!isGuest){if(BUILD_REQUIRED>-1){if(!has(I.settings,"build")||(I.settings.build<BUILD_REQUIRED)){alert("The WebUI requires atleast \u00B5Torrent (build "+BUILD_REQUIRED+")");return }}for(var E=0,D=I.settings.length;E<D;E++){var H=I.settings[E][0],C=I.settings[E][1],B=I.settings[E][2];if((H=="webui.cookie")&&!this.loaded){var A=JSON.decode(I.settings[E][2],true);$extend(this.config,A);this.config.torrentTable.alternateRows=this.config.fileTable.alternateRows=this.config.alternateRows;continue}if((H!="proxy.proxy")&&(H!="webui.username")&&(H!="webui.password")){if(C==0){B=parseInt(B)}if(C==1){B=(B=="true")}}this.settings[I.settings[E][0]]=B}delete I.settings}if(!isGuest){this.loadSettings()}if(!this.loaded){var G=(navigator.language)?navigator.language:navigator.userLanguage;var F;if(F=G.match(/af|ar|az|be|ca|cs|de|en|eo|es|et|fr|it|jp|nl|pt|sv/i)){G=F[0]}if((lang!==null)&&((lang_code==this.config.lang)||((this.config.lang=="auto")&&(lang_code==G)))){setupUI();if(isGuest){this.update()}else{this.loadTorrents(I)}}else{loadJS(this.url+"lang/"+((this.config.lang=="auto")?G:this.config.lang)+".js",{onload:isGuest?setupUI:function(){setupUI();utWebUI.loadTorrents(I)}})}}},loadSettings:function(){for(var B in this.settings){var A=this.settings[B],C;if(!(C=$(B))){continue}if(C.type=="checkbox"){C.checked=!!A}else{if(B=="seed_ratio"){A/=10}C.set("value",A)}C.fireEvent("change")}["showDetails","showCategories","showToolbar","showTitleSpeed","updateInterval","alternateRows","confirmDelete","lang"].each(function(E){var F;if(!(F=$("webui."+E))){return }var D=utWebUI.config[E];if(F.type=="checkbox"){F.checked=((D==1)||(D==true))}else{F.set("value",D)}});this.config.torrentTable.maxRows=this.config.fileTable.maxRows=this.config.torrentTable.maxRows.max(5);$("webui.maxRows").set("value",this.config.torrentTable.maxRows);if(!this.config.showCategories){$("CatList").hide()}if(!this.config.showDetails&&!isGuest){$("tdetails").hide()}if(!this.config.showToolbar&&!isGuest){$("toolbar").hide()}},setSettings:function(){var G=null,C=false,A=false,B=false;G=$("webui.confirmDelete").checked;if(this.config.confirmDelete!=G){this.config.confirmDelete=G&1;B=true}G=$("webui.updateInterval").get("value").toInt();if(this.config.updateInterval!=G){this.config.updateInterval=G;$clear(this.updateTimeout);this.updateTimeout=this.update.delay(G,this);B=true}G=$("webui.showTitleSpeed").checked;if(this.config.showTitleSpeed!=G){this.config.showTitleSpeed=G;if(!this.config.showTitleSpeed){document.title="\u00B5Torrent WebUI v"+VERSION}B=true}G=$("webui.alternateRows").checked;if(this.config.alternateRows!=G){this.config.alternateRows=G;this.trtTable.options.alternateRows=this.flsTable.options.alternateRows=this.config.alternateRows;this.trtTable.refreshSelection();this.flsTable.refreshSelection();B=true}G=$("webui.showCategories").checked;if(this.config.showCategories!=G){this.config.showCategories=(G)?1:0;$("CatList")[(!this.config.showCategories)?"hide":"show"]();C=true;B=true}G=$("webui.showDetails").checked;if(this.config.showDetails!=G){this.config.showDetails=(G)?1:0;$("tdetails")[(!this.config.showDetails)?"hide":"show"]();C=true;B=true}G=$("webui.maxRows").value.toInt();if(this.config.torrentTable.maxRows!=G){this.config.torrentTable.maxRows=this.config.fileTable.maxRows=G;A=true;B=true}G=$("webui.lang").get("value");if(this.config.lang!=G){this.config.lang=G;A=true;B=true}var F="";if(Browser.Engine.presto&&B){F="&s=webui.cookie&v="+JSON.encode(this.config)}var H=-1,E=-1;for(var I in this.settings){v=this.settings[I];var J=$(I);if(!J){continue}if(J.type&&(J.type=="checkbox")){nv=J.checked?1:0}else{nv=J.get("value")}if(I=="seed_ratio"){nv*=10}if(v!=nv){this.settings[I]=nv;if(I=="webui.port"){E=v}else{if(I=="bind_port"){H=v}else{if(I=="gui.persistent_labels"){nv=encodeURIComponent(nv)}}}F+="&s="+I+"&v="+nv}}if(F!=""){this.request("action=setsetting"+F,$empty,!A)}if(this.settings["webui.enable"]==0){$("msg").set("html","Goodbye.");$("cover").show();return }var D=(location.host.split(":"))[1];if(!$defined(D)){D=(window.location.protocol=="http:")?80:443}if((this.settings["webui.enable_listen"])&&(E!=-1)&&((E==D)||(H==D))){$("msg").set("html","Redirecting...");$("cover").show();redirect.delay(500,null,window.location.protocol+"//"+document.domain+":"+this.settings["webui.port"]+"/gui/")}else{if((!this.settings["webui.enable_listen"])&&(H!=-1)&&((H==D)||(E==D))){$("msg").set("html","Redirecting...");$("cover").show();redirect.delay(500,null,window.location.protocol+"//"+document.domain+":"+this.settings.bind_port+"/gui/")}else{if(A){window.location.reload()}else{if(C){resizeUI()}}}}},showSettings:function(){if(!this.langLoaded&&!isGuest){loadSettingStrings()}$("dlgSettings").setStyle("zIndex",++winZ).centre()},trtSelect:function(A,B){if(A.rightClick){if(this.config.showDetails&&(this.trtTable.selectedRows.length==1)){this.showDetails(B)}if(this.trtTable.selectedRows.length>0){this.showMenu(A,B)}}else{if(this.config.showDetails){if(this.trtTable.selectedRows.length==0){this.torrentID="";this.flsTable.clearRows();this.clearDetails()}else{if(this.trtTable.selectedRows.length==1){this.showDetails(B)}}}}},showMenu:function(F,B){var A=this.torrents[B][0];var D=[lang[CONST.ML_FORCE_START],this.forceStart.bind(this)];var C=[lang[CONST.ML_START],this.start.bind(this)];var J=[lang[CONST.ML_PAUSE],this.pause.bind(this)];var G=[lang[CONST.ML_STOP],this.stop.bind(this)];var H=[lang[CONST.ML_FORCE_RECHECK],this.recheck.bind(this)];ContextMenu.clear();if(!(A&64)){ContextMenu.add([lang[CONST.ML_FORCE_START]])}else{ContextMenu.add(D)}if(this.trtTable.selCount>1){ContextMenu.clear();ContextMenu.add(D);ContextMenu.add(C);ContextMenu.add(J);ContextMenu.add(G);ContextMenu.add([CMENU_SEP]);ContextMenu.add(H)}else{if((A&1)&&!(A&2)){if(A&32){ContextMenu.clear();ContextMenu.add(D);ContextMenu.add(C);ContextMenu.add(J)}else{if(!(A&64)){ContextMenu.add(C)}else{ContextMenu.add([lang[CONST.ML_START]])}ContextMenu.add(J)}ContextMenu.add(G);ContextMenu.add([CMENU_SEP]);ContextMenu.add([lang[CONST.ML_FORCE_RECHECK]])}else{if(A&2){ContextMenu.clear();if((A&4)||(A&32)){ContextMenu.add([lang[CONST.ML_FORCE_START]])}else{ContextMenu.add(D)}if(A&64){ContextMenu.add([lang[CONST.ML_START]])}else{ContextMenu.add(C)}ContextMenu.add(J);ContextMenu.add(G);ContextMenu.add([CMENU_SEP]);ContextMenu.add([lang[CONST.ML_FORCE_RECHECK]])}else{if(A&16){ContextMenu.clear();ContextMenu.add(D);ContextMenu.add([lang[CONST.ML_START]]);ContextMenu.add([lang[CONST.ML_PAUSE]]);ContextMenu.add(G);ContextMenu.add([CMENU_SEP]);ContextMenu.add(H)}else{if(A&64){ContextMenu.add([lang[CONST.ML_START]]);ContextMenu.add(J);ContextMenu.add(G);ContextMenu.add([CMENU_SEP]);ContextMenu.add(H)}else{ContextMenu.clear();ContextMenu.add(D);ContextMenu.add(C);ContextMenu.add([lang[CONST.ML_PAUSE]]);ContextMenu.add([lang[CONST.ML_STOP]]);ContextMenu.add([CMENU_SEP]);ContextMenu.add(H)}}}}}ContextMenu.add([CMENU_SEP]);var I=[],E=this;$each(this.customLabels,function(L,K){K=K.substr(1,K.length-2);if(E.trtTable.selectedRows.every(function(M){return(E.torrents[M][11]==K)})){I.push([CMENU_SEL,K])}else{I.push([K,E.setLabel.bind(E,K)])}});I.push([CMENU_SEP]);I.push([lang[CONST.OV_NEW_LABEL],this.newLabel.bind(this)]);I.push([lang[CONST.OV_REMOVE_LABEL],this.setLabel.bind(this,"")]);if(I.length>0){ContextMenu.add([CMENU_CHILD,lang[CONST.ML_LABEL],I]);ContextMenu.add([CMENU_SEP])}ContextMenu.add([lang[CONST.ML_REMOVE],this.remove.bind(this,0)]);ContextMenu.add([CMENU_CHILD,lang[CONST.ML_REMOVE_AND],[[lang[CONST.ML_DELETE_DATA],this.remove.bind(this,1)]]]);ContextMenu.add([CMENU_SEP]);ContextMenu.add([lang[CONST.ML_PROPERTIES],(this.trtTable.selCount>1)?null:this.showProperties.bind(this,B)]);ContextMenu.show(F.page)},showProperties:function(A){this.propID=A;this.request("action=getprops&hash="+A,this.loadProperties)},loadProperties:function(B){var C=B.props[0],D=this.propID;if(!has(this.props,D)){this.props[D]={}}for(var A in C){this.props[D][A]=C[A]}this.updateProperties()},updateProperties:function(){var D=this.props[this.propID];$("prop-trackers").value=D.trackers;$("prop-ulrate").value=(D.ulrate/1024).toInt();$("prop-dlrate").value=(D.dlrate/1024).toInt();$("prop-ulslots").value=D.ulslots;var E=$("prop-seed_override");E.checked=!!D.seed_override;E.fireEvent("change");$("prop-seed_ratio").value=D.seed_ratio/10;$("prop-seed_time").value=D.seed_time;$("prop-superseed").checked=D.superseed;var C={superseed:17,dht:18,pex:19};for(var B in C){var A=(D[B]==-1);if(B=="dht"){A=!this.settings.dht_per_torrent}E=$("prop-"+B);E.disabled=A;E.checked=(D[B]==1);$("DLG_TORRENTPROP_1_GEN_"+C[B])[A?"addClass":"removeClass"]("disabled")}$("dlgProps").setStyle("zIndex",++winZ).centre()},setProperties:function(){var H="";for(var E in this.props[this.propID]){if(E=="hash"){continue}var D=this.props[this.propID][E],C,G=$("prop-"+E);if(G.type=="checkbox"){C=G.checked?1:0}else{C=G.get("value")}if((E=="dht")&&(D==-1)){continue}else{if((E=="pex")&&(D==-1)){continue}else{if(E=="seed_ratio"){C*=10}else{if(E=="dlrate"){C*=1024}else{if(E=="ulrate"){C*=1024}else{if(E=="trackers"){var B=C.split("\n"),A=B.length;C="";for(var F=0;F<A;F++){C+=B[F].replace(/\s+/,"")+"\r\n"}if(C.substr(-4,4)=="\r\n\r\n"){C=C.substr(0,C.length-2)}}}}}}}if(D!=C){H+="&s="+E+"&v="+encodeURIComponent(C);this.props[this.propID][E]=C}}if(H!=""){this.request("action=setprops&hash="+this.propID+H)}},showDetails:function(A){this.flsTable.clearRows();this.torrentID=A;this.getFiles(A);this.updateDetails()},clearDetails:function(){["rm","dl","ul","ra","us","ds","se","pe"].each(function(A){$(A).set("html","")})},updateDetails:function(){if(this.torrentID!=""){var A=this.torrents[this.torrentID].slice(1);$("dl").set("html",A[4].toFileSize());$("ul").set("html",A[5].toFileSize());$("ra").set("html",(A[6]==-1)?"\u221E":(A[6]/1000).roundTo(3));$("us").set("html",A[8].toFileSize()+perSec);$("ds").set("html",A[7].toFileSize()+perSec);$("rm").set("html",(A[9]==0)?"":(A[9]<=-1)?"\u221E":A[9].toTimeString());$("se").set("html",lang[CONST.GN_XCONN].replace(/%d/,A[13]).replace(/%d/,A[14]).replace(/%d/,"\u00BF?"));$("pe").set("html",lang[CONST.GN_XCONN].replace(/%d/,A[11]).replace(/%d/,A[12]).replace(/%d/,"\u00BF?"))}},addURL:function(){var A=escape($("url").get("value"));$("url").set("value","");if(A!=""){var B=$("cookies").get("value");$("cookies").set("value","");if(B!=""){A+=":COOKIE:"+B}this.request("action=add-url&s="+A,$empty)}},updateFiles:function(A){if((this.torrentID==A)&&has(this.files,A)){this.getFiles(A,true);this.updateDetails()}},loadFiles:function(){var A=this.torrentID;if(A!=""){if(!has(this.flsTable.rowData,A+"_0")){this.flsTable.dBody.scrollLeft=0;this.flsTable.dBody.scrollTop=0;this.files[A].each(function(C,B){var D=$A(C);D.push(D[3].toInt());D[3]=((D[1]>0)?((D[2]/D[1])*100).roundTo(1):100);this.flsTable.addRow(D,A+"_"+B)},this);this.flsTable.calcSize();this.flsTable.refreshRows()}this.flsTable.loadObj.hide.delay(200,this.flsTable.loadObj)}},getFiles:function(B,A){if(!has(this.files,B)||A){this.files[B]=[];if(A){this.flsTable.clearRows()}if(this.tabs.active=="FileList"){this.flsTable.loadObj.show()}this.request("action=getfiles&hash="+B,this.addFiles)}else{if(this.tabs.active=="FileList"){this.flsTable.loadObj.show();this.loadFiles.delay(20,this)}}},addFiles:function(A){var B=A.files;if(B==undefined){return }this.files[B[0]]=B[1];if(this.tabs.active=="FileList"){this.loadFiles()}},flsSelect:function(A,B){if(this.flsTable.selectedRows.length>0){this.showFileMenu(A,B.substr(41).toInt())}},showFileMenu:function(G,D){if(!G.rightClick){return }var H=this.torrentID;var F=this.files[H][D][3];var C=["High Priority",this.setPriority.bind(this,[H,3])];var E=["Normal Priority",this.setPriority.bind(this,[H,2])];var A=["Low Priority",this.setPriority.bind(this,[H,1])];var B=["Don't Download",this.setPriority.bind(this,[H,0])];ContextMenu.clear();if(this.flsTable.selCount>1){ContextMenu.add(C);ContextMenu.add(E);ContextMenu.add(A);ContextMenu.add([CMENU_SEP]);ContextMenu.add(B)}else{if(F==0){ContextMenu.add(C);ContextMenu.add(E);ContextMenu.add(A);ContextMenu.add([CMENU_SEP]);ContextMenu.add(["Don't Download"])}else{if(F==1){ContextMenu.add(C);ContextMenu.add(E);ContextMenu.add(["Low Priority"]);ContextMenu.add([CMENU_SEP]);ContextMenu.add(B)}else{if(F==2){ContextMenu.add(C);ContextMenu.add(["Normal Priority"]);ContextMenu.add(A);ContextMenu.add([CMENU_SEP]);ContextMenu.add(B)}else{if(F==3){ContextMenu.add(["High Priority"]);ContextMenu.add(E);ContextMenu.add(A);ContextMenu.add([CMENU_SEP]);ContextMenu.add(B)}}}}}ContextMenu.show(G.page)},getFileIds:function(E,D){var C=[];var A=this.flsTable.selectedRows.length;while(A--){var B=this.flsTable.selectedRows[A].substr(41).toInt();if(this.files[E][B][3]!=D){C.push(B);this.files[E][B][3]=D;this.flsTable.setValue(this.flsTable.selectedRows[A],4,D)}}return C},setPriority:function(B,A){this.request("action=setprio&hash="+B+"&p="+A+"&f="+this.getFileIds(B,A).join("&f="))},trtSort:function(B,A){this.config.torrentTable.sIndex=B;this.config.torrentTable.reverse=A;if(Browser.Engine.presto){this.saveConfig(true)}},trtColMove:function(){this.config.torrentTable.colOrder=this.trtTable.colOrder;this.config.torrentTable.sIndex=this.trtTable.sIndex;if(Browser.Engine.presto){this.saveConfig(true)}},trtColResize:function(){this.config.torrentTable.colWidth=this.trtTable.colWidth;if(Browser.Engine.presto){this.saveConfig(true)}},trtColToggle:function(C,B){var A=1<<C;if(B){this.config.trtCols|=A}else{this.config.trtCols&=~A}if(Browser.Engine.presto){this.saveConfig(true)}},flsSort:function(B,A){this.config.fileTable.sIndex=B;this.config.fileTable.reverse=A;if(Browser.Engine.presto){this.saveConfig(true)}},flsColMove:function(){this.config.fileTable.colOrder=this.flsTable.colOrder;this.config.fileTable.sIndex=this.flsTable.sIndex;if(Browser.Engine.presto){this.saveConfig(true)}},flsColResize:function(){this.config.fileTable.colWidth=this.flsTable.colWidth;if(Browser.Engine.presto){this.saveConfig(true)}},flsColToggle:function(C,B){var A=1<<C;if(B){this.config.flsCols|=A}else{this.config.flsCols&=~A}if(Browser.Engine.presto){this.saveConfig(true)}},restoreUI:function(A){if((A!=false)&&!confirm("Are you sure that you want to restore the interface?")){return }$("msg").set("html","Reloading...");$("cover").show();window.removeEvents("unload");utWebUI.request("action=setsetting&s=webui.cookie&v={}",function(){window.location.reload(false)})},saveConfig:function(A){new Request({url:this.url+"?action=setsetting&s=webui.cookie&v="+JSON.encode(this.config),method:"get",async:A||false}).send()},toggleCatPanel:function(){var A=!this.config.showCategories;$("CatList")[A?"show":"hide"]();this.config.showCategories=A;resizeUI()},toggleDetPanel:function(){var A=!this.config.showDetails;$("tdetails")[A?"show":"hide"]();this.config.showDetails=A;resizeUI.delay(0)},toggleToolbar:function(){var A=!this.config.showToolbar;$("toolbar")[A?"show":"hide"]();this.config.showToolbar=A;resizeUI.delay(0)},tabChange:function(A){if(A=="FileList"){if(this.torrentID==""){this.flsTable.calcSize();return }if(has(this.flsTable.rowData,this.torrentID+"_0")){return }this.flsTable.loadObj.show();this.loadFiles.delay(20,this)}}};