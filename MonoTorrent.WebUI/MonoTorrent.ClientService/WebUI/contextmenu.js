var CMENU_SEP=0;var CMENU_CHILD=1;var CMENU_SEL=2;var CMENU_CHECK=3;var LI=new Element("li");var ContextMenu={init:function(A){this.obj=new Element("ul",{id:A,"class":"CMenu"}).addEvent("mouseenter",function(){ContextMenu.focused=true}).addEvent("mouseleave",function(){ContextMenu.focused=false}).inject(document.body)},hideAfterClick:true,hidden:true,focused:false,launched:false,add:function(){var F=$A(arguments);var H,E,I;var J=F[0];if($type(J)=="element"){if(!J.hasClass("CMenu")){return }F.splice(0,1)}else{J=this.obj}for(var C=0,B=F.length;C<B;C++){I=LI.clone(false);H=new Element("a");if(F[C][0]===CMENU_SEP){I.adopt(new Element("div",{"class":"hr"}))}else{if(F[C][0]===CMENU_CHILD){E=new Element("ul");E.addClass("CMenu");H.addClass("exp");H.set("html",F[C][1]);I.adopt(H);for(var A=0,D=F[C][2].length;A<D;A++){this.add(E,F[C][2][A])}I.adopt(E)}else{if(F[C][0]===CMENU_SEL){H.addClass("sel");H.set("html",F[C][1]);I.adopt(H)}else{if(F[C][0]===CMENU_CHECK){H.addClass("check");H.setProperty("href","#");var G=F[C][2];H.addEvent("click",function(K){K.stop();G();if(ContextMenu.hideAfterClick){ContextMenu.hide()}});H.set("html",F[C][1]);I.adopt(H)}else{if(!$defined(F[C][1])){H.addClass("dis");H.set("html",F[C][0]);I.adopt(H)}else{H.setProperty("href","#");var G=F[C][1];H.addEvent("click",function(K){K.stop();G();if(ContextMenu.hideAfterClick){ContextMenu.hide()}});H.set("html",F[C][0]);I.adopt(H)}}}}}J.adopt(I)}},clear:function(){this.obj.empty();this.hideAfterClick=true},show:function(D){this.obj.setStyle("visibility","hidden");this.obj.show();var A=D.x+8;var C=this.obj.getSize();var B=window.getSize();if(A+C.x>B.x){A-=C.x}var E=D.y+8;if(E+C.y>B.y){E-=C.y}this.obj.setStyles({left:A,top:E,visibility:"visible"});this.hidden=false;this.focused=false;this.launched=true},hide:function(){this.obj.setStyles({visibility:"hidden",display:"none",left:0,top:0});this.hidden=true;this.focused=false;this.launched=false;this.clear.delay(20,this)}};