var TYPE_STRING=0;var TYPE_NUMBER=1;var TYPE_DATE=2;var TYPE_STRING_NO_CASE=3;var TYPE_NUM_ORDER=3;var ALIGN_AUTO=0;var ALIGN_LEFT=1;var ALIGN_CENTER=2;var ALIGN_RIGHT=3;var MODE_PAGE=0;var MODE_VIRTUAL=1;var NO_CHANGE=0;var HAS_CHANGED=1;var TD=new Element("td");var TR=new Element("tr");var DIV=new Element("div");function simpleClone(A,B){A=$(A.cloneNode(!!B));A.uid=null;$uid(A);return A}var dxSTable=new Class({Implements:[Options,Events],rows:0,rowData:{},rowId:[],rowSel:{},selectedRows:[],stSel:null,activeId:[],activePos:{},viewRows:0,cols:0,colData:[],dCont:null,dHead:null,dBody:null,tHead:null,tBody:null,tb:{head:null,body:null},sIndex:-1,reverse:0,secIndex:0,secRev:0,colOrder:[],colWidth:[],colHeader:[],options:{format:$arguments(0),maxRows:25,alternateRows:false,mode:MODE_PAGE,rowsSelectable:true,refreshable:false},startSel:null,tHeadCols:[],tBodyCols:[],cancelSort:false,cancelMove:false,hotCell:-1,colMove:null,colSep:null,isMoving:false,isResizing:false,isSorting:false,isScrolling:false,selCount:0,curPage:0,pageCount:0,rowCache:[],rowCover:null,create:function(C,G,N){this.colHeader=G;this.colWidth=N.colWidth||(new Array(G.length));this.colOrder=N.colOrder||(new Array(G.length));this.sIndex=isNaN(N.sIndex)?-1:N.sIndex.toInt().limit(-1,G.length-1);delete N.colOrder;delete N.colWidth;delete N.sIndex;this.setOptions(N);var M,F,B,J=this,D=Browser.Engine.trident;this.id="stable-"+C;this.dCont=$(C).addClass("stable");this.dHead=simpleClone(DIV,false).addClass("stable-head").inject(this.dCont);this.dBody=simpleClone(DIV,false).addClass("stable-body").inject(this.dCont);this.tHead=new Element("table",{cellpadding:0,cellspacing:0}).inject(this.dHead);this.tHead.addEvent("contextmenu",function(O){O.stop();return false});this.tb.head=new Element("tbody").inject(this.tHead);M=simpleClone(TR,false);var E=new Drag(M,{modifiers:{x:"left",y:false},snap:1,onBeforeStart:function(){if(J.hotCell>=0){J.rowCover.show()}},onStart:function(){ColumnHandler.start(J,this)},onDrag:function(){ColumnHandler.drag(J,this)},onComplete:function(){ColumnHandler.end(J,this)},onRightClick:this.colMenu.bind(this),onCancel:function(O,P){this.detach();J.cancelSort=false;J.rowCover.hide();J.sort(this.element,P.shift)}}).detach();M.addEvent("mousemove",function(P){var Q=P.target;if(!Q){return }var O=Q.get("tag");if(O=="span"){Q=Q.parentNode;O="td"}if(O=="td"){ColumnHandler.check.apply(J,[P,Q])}}).addEvent("mousedown",function(P){var Q=P.target;if(!Q){return }var O=Q.get("tag");if(O=="span"){Q=Q.parentNode;O="td"}if(O=="td"){E.element=E.handles=Q;E.attach().start(P)}});var L=this.colHeader.length,K=simpleClone(TR,false);for(var I=0,H=0;I<L;I++){this.colOrder[I]=(typeof this.colOrder[I]=="number")?this.colOrder[I].limit(0,L-1):I;this.cols++;this.colData[I]=this.colHeader[this.colOrder[I]];K.grab(simpleClone(TD,false).addClass(this.id+"-col-"+this.colOrder[I]).setStyle(D?"visibility":"display",this.colData[I].disabled?(D?"hidden":"none"):(D?"visible":"")));F=simpleClone(TD,false).grab(new Element("span",{text:this.colData[I].text})).setStyles({width:this.colWidth[this.colOrder[I]],display:this.colData[I].disabled?"none":""}).store("index",I).inject(M);this.tHeadCols[I]=F;H++}this.tb.head.grab(M);this.rowCover=new Element("div",{"class":"rowcover"}).inject(this.dHead);if(this.options.mode==MODE_VIRTUAL){this.topPad=simpleClone(DIV,false).addClass("stable-pad").inject(this.dBody)}this.tBody=new Element("table",{cellpadding:0,cellspacing:0}).inject(this.dBody);if(this.options.mode==MODE_VIRTUAL){this.bottomPad=simpleClone(DIV,false).addClass("stable-pad").inject(this.dBody)}var A=new Element("colgroup").inject(this.tBody);for(var I=0;I<L;I++){this.tBodyCols[I]=new Element("col",{styles:{width:this.colWidth[this.colOrder[I]],display:this.colData[I].disabled?"none":""},width:this.colWidth[this.colOrder[I]],span:1}).inject(A)}this.tb.body=new Element("tbody");if(Browser.Engine.trident){this.tb.body.addEvent("selectstart",function(){return false})}this.colDragEle=null;this.colDragObj=simpleClone(DIV,false).addClass("stable-move-header").inject(this.dHead);this.colSep=simpleClone(DIV,false).addClass("stable-separator-header").inject(this.dHead);this.colReszObj=simpleClone(DIV,false).addClass("stable-resize-header").inject(this.dBody);this.loadObj=simpleClone(DIV,false).addClass("stable-loading").grab(simpleClone(DIV,false).addClass("stable-loading-text").set("html","Loading...")).inject(this.dCont);if(this.options.rowsSelectable){this.dBody.addEvent("mousedown",function(O){var P=O.target;if(!P){return }if(P.get("tag")=="td"){J.selectRow(O,P.parentNode)}}).addEvent("click",function(O){var P=O.target;if(!P){return }if(P.get("tag")!="td"){var Q=this.getPosition();if((this.clientWidth>O.page.x-Q.x-this.scrollLeft+2)&&(this.clientHeight>O.page.y-Q.y-this.scrollTop+2)){J.clearSelection();J.fireEvent("onSelect",[O,""])}}})}for(var I=0;I<this.options.maxRows;I++){this.tb.body.appendChild(simpleClone(K,true).hide())}K=null;this.tBody.grab(this.tb.body);if(this.options.mode==MODE_PAGE){this.pageMenu=simpleClone(DIV,false).addClass("stable-pagemenu").inject(this.dCont);if(this.options.rowsSelectable){this.pageInfo=new Element("span",{"class":"pageinfo",text:"0 row(s) selected."}).inject(this.pageMenu)}this.pageNext=simpleClone(DIV,false).addClass("nextlink-disabled").addEvent("click",this.nextPage.bind(this)).addEvent("mouseenter",function(){if(this.hasClass("nextlink")){this.addClass("nextlink-hover")}}).addEvent("mouseleave",function(){if(this.hasClass("nextlink")){this.removeClass("nextlink-hover")}}).inject(this.pageMenu);this.pagePrev=simpleClone(DIV,false).addClass("prevlink-disabled").addEvent("click",this.prevPage.bind(this)).addEvent("mouseenter",function(){if(this.hasClass("prevlink")){this.addClass("prevlink-hover")}}).addEvent("mouseleave",function(){if(this.hasClass("prevlink")){this.removeClass("prevlink-hover")}}).inject(this.pageMenu);this.pageStat=new Element("span").addClass("pagestat").inject(this.pageMenu);this.pageSelect=new Element("select",{events:{change:function(){J.gotoPage(this.get("value").toInt())}}}).inject(this.pageStat);this.pageSelect.disabled=true;if(this.options.refreshable){this.pageStat.grab(new Element("a",{"class":"refreshBtn",href:"#",events:{click:function(O){O.stop();if(J.rows){J.fireEvent("onRefresh")}}}}).grab(new Element("div")))}}this.assignEvents();this.setAlignment()},assignEvents:function(){var B=0,A=null;this.dBody.addEvent("scroll",(function(){this.dHead.scrollLeft=this.dBody.scrollLeft;if(this.options.mode==MODE_PAGE){return }if(B===0){B=this.dBody.scrollTop}else{var C=Math.abs(B-this.dBody.scrollTop);if(C>0){this.isScrolling=true;$clear(A);this.scrollTimer=(function(){B=0;$clear(A);this.isScrolling=false;this.resizePads();this.loadObj.show();this.refreshRows()}).bind(this).delay(300)}else{$clear(A)}}return false}).bind(this));if(!this.options.rowsSelectable){return }this.dCont.addEvent("keydown",(function(C){if(C.key=="delete"){this.fireEvent("onDelete")}else{if((C.key=="a")&&C.control){this.fillSelection();this.fireEvent("onSelect",C)}else{if((C.key=="e")&&C.control){this.clearSelection();this.fireEvent("onSelect",C)}}}}).bind(this));if(Browser.Engine.gecko){this.dBody.addEvent("mousedown",function(C){this.focus()}).setProperty("tabIndex",-1)}},setAlignment:function(){var D="",B=this.tBody.getElement("colgroup").getElements("col");for(var A=0;A<this.cols;A++){var C="";switch(this.colData[A].align){case ALIGN_LEFT:C="left";break;case ALIGN_CENTER:C="center";break;case ALIGN_RIGHT:C="right";break;case ALIGN_AUTO:default:C=(this.colData[A].type==TYPE_NUMBER)?"right":"left"}this.tHeadCols[A].setStyle("textAlign",C);if(Browser.Engine.trident){B[A].setStyle("textAlign",C)}else{D+="."+this.id+"-col-"+this.colOrder[A]+" { text-align: "+C+" }"}}if(!Browser.Engine.trident){$("colrules").appendText(D)}},getCache:function(A){if(this.rowCache.length!=this.rows){this.clearCache();this.rowCache=new Array(this.rows)}var C=0,A=this.colOrder[A];for(var B in this.rowData){this.rowCache[C++]={key:B,v:this.rowData[B].data[A],e:this.rowData[B]}}},clearCache:function(B){var A=this.rowCache.length;while(A--){this.rowCache[A].key=null;this.rowCache[A].v=null;this.rowCache[A].e=null;this.rowCache[A]=null}this.rowCache.length=0},sort:function(D,B){if(this.cancelSort){return }this.isSorting=true;var I=true,A=true;if(D==null){if(this.sIndex==-1){return }I=false;D=this.tb.head.childNodes[0].childNodes[this.sIndex];A=false}if(D.get("tag")!="td"){D=D.getParent("td")}var C=D.retrieve("index");if(B){if(C==this.sIndex){this.secIndex=0;return }if(this.secIndex==C){this.secRev=1-this.secRev}else{this.secRev=0}this.secIndex=C;C=this.sIndex;I=false;D=this.tb.head.childNodes[0].childNodes[this.sIndex];A=false}if(I){this.options.reverse=(this.sIndex==C)?!this.options.reverse:false}if(this.sIndex!=C){A=false;this.getCache(C);if(this.sIndex>=0){this.tb.head.childNodes[0].childNodes[this.sIndex].setStyle("backgroundPosition","right -32px")}}D.setStyle("backgroundPosition","right "+((this.options.reverse)?"0px":"-16px"));this.sIndex=C;if(!A){var G=this,H;switch(this.colData[C].type){case TYPE_STRING:H=function(L,M){return G.sortAlphaNumeric(L,M)};break;case TYPE_NUMBER:H=function(L,M){return G.sortNumeric(L,M)};break;case TYPE_NUM_ORDER:H=function(L,M){return G.sortNumOrder(L,M)};break;default:H=function(L,M){return Comparator.compare(L.v,M.v)};break}this.rowCache.sort(H)}this.clearActive();var E=this.rows,F=0,J=1;if(this.options.reverse){E=J=-1;F=this.rows-1}while(F!=E){var K=this.rowCache[F].key;if(!this.rowCache[F].e.hidden){this.activePos[K]=this.activeId.length;this.activeId.push(K)}this.rowData[K].index=F;F+=J}this.isSorting=false;this.curPage=0;this.refreshRows();this.fireEvent("onSort",[this.sIndex,this.options.reverse])},sortNumeric:function(A,C){var B=Comparator.compareNumeric(A.v,C.v);return(((B==0)&&(this.secIndex!=this.sIndex))?this.sortSecondary(A,C):B)},sortNumOrder:function(A,C){var B=Comparator.compareNumeric(A.v,C.v);if(B!=0){if(A.v==-1){B=1}else{if(C.v==-1){B=-1}}}return(((B==0)&&(this.secIndex!=this.sIndex))?this.sortSecondary(A,C):B)},sortAlphaNumeric:function(A,C){var B=Comparator.compareAlphaNumeric(A.v,C.v);return(((B==0)&&(this.secIndex!=this.sIndex))?this.sortSecondary(A,C):B)},sortSecondary:function(B,G){var C=this.colOrder[this.secIndex];var A=B.e.data[C];var F=G.e.data[C];var D=this.colData[C].type;var E=0;switch(D){case TYPE_STRING:E=Comparator.compareAlphaNumeric(A,F);break;case TYPE_NUMBER:E=Comparator.compareNumeric(A,F);break;case TYPE_NUM_ORDER:E=Comparator.compareNumeric(A,F);if(E!=0){if(A==-1){E=1}else{if(F==-1){E=-1}}}break;default:E=Comparator.compare(A,F)}if(E==0){E=B.e.index-G.e.index}if(this.options.reverse){E=-E}if(this.secRev){E=-E}return E},getActiveRange:function(){var A=this.options.maxRows,D=0,C=0;if(this.options.mode==MODE_VIRTUAL){var B=(this.dBody.scrollHeight==0)?0:(this.dBody.scrollTop/this.dBody.scrollHeight);if(B>1){B=1}D=Math.floor(B*this.activeId.length)}else{D=A*this.curPage}C=(D+A-1).min(this.activeId.length-1);return[D,C]},refreshRows:function(){var E=this.getActiveRange();if(Browser.Engine.gecko||Browser.Engine.trident4){this.detachBody()}var G=0;for(var D=E[0];D<=E[1];D++){var A=this.activeId[D],F=this.rowData[A],I=$(A)||this.tb.body.childNodes[G],C=this.options.format($A(F.data));var B="",H=I.hasClass("selected");if(has(this.rowSel,A)){B+="selected";H=!H}if(this.options.alternateRows){if(G&1){B+=" odd";H=H|!I.hasClass("odd")}else{B+=" even";H=H|!I.hasClass("even")}}if(H){I.className=B.clean()}this.fillRow(I,C,F.icon);if(I!=this.tb.body.childNodes[G]){I.inject(this.tb.body.childNodes[G],"before")}I.setProperties({title:C[0],id:A}).show(true);F.rowIndex=G++}for(var D=G;D<this.options.maxRows;D++){this.tb.body.childNodes[D].setProperty("id","").hide()}if(Browser.Engine.gecko||Browser.Engine.trident4){this.attachBody()}this.loadObj.hide();this.refresh();this.requiresRefresh=false},refresh:function(){if(this.isScrolling){return }this.updatePageMenu();this.dHead.setStyle("width",this.dBody.clientWidth);this.rowCover.setStyle("width",this.dBody.clientWidth)},selectRow:function(H,J){var A=J.id;if(!(H.rightClick&&has(this.rowSel,A))){if(H.shift){if(this.stSel===null){this.stSel=A;this.rowSel[A]=0;this.selectedRows.push(A)}else{var C=this.activePos[this.stSel];var B=this.activePos[A];var G=C.min(B);var D=C.max(B);this.selectedRows.length=0;delete this.rowSel;this.rowSel={};for(var F=G;F<=D;F++){var I=this.activeId[F];this.rowSel[I]=this.selectedRows.length;this.selectedRows.push(I)}}}else{if(H.control){this.stSel=A;if(has(this.rowSel,A)){this.selectedRows.splice(this.rowSel[A],1);for(var F=this.rowSel[A],E=this.selectedRows.length;F<E;F++){this.rowSel[this.selectedRows[F]]--}delete this.rowSel[A]}else{this.rowSel[A]=this.selectedRows.length;this.selectedRows.push(A)}}else{this.stSel=A;this.selectedRows.length=0;delete this.rowSel;this.rowSel={};this.rowSel[A]=0;this.selectedRows.push(A)}}if(this.selectedRows.length==0){this.stSel=null}this.refreshSelection()}this.fireEvent("onSelect",[H,A])},addRow:function(C,D,A,B){if(C.length!=this.cols){return }D=D||(this.id+"-row-"+(1000+this.rows));this.rowData[D]={data:C,icon:A||"",hidden:B||false,index:-1,rowIndex:-1};this._insertRow(D);this.rows++},_insertRow:function(A,F){F=!!F;var L=this.sIndex;if(L>=0){var G=this,I=0;if(!F){var H,J=0,K=this.rowCache.length,B=this.rowData[A].index,M={key:A,v:this.rowData[A].data[this.colOrder[L]],e:this.rowData[A]};switch(this.colData[L].type){case TYPE_STRING:H=function(N,O){return G.sortAlphaNumeric(N,O)};break;case TYPE_NUMBER:H=function(N,O){return G.sortNumeric(N,O)};break;case TYPE_NUM_ORDER:H=function(N,O){return G.sortNumOrder(N,O)};break;default:H=function(N,O){return Comparator.compare(N.v,O.v)};break}if(B>=0){if((B!=0)&&(H(M,this.rowCache[B-1])<0)){K=B+1}else{if((B<this.rowCache.length-1)&&(H(M,this.rowCache[B+1])>0)){J=B}}}I=this.rowCache.binarySearch(M,H,J,K);if(I<0){I=-(I+1)}if(B>=0){if(B<I){I--}this.rowCache.splice(B,1)}this.rowCache.splice(I,0,M);if(B==-1){for(var D=I,C=this.rowCache.length;D<C;D++){this.rowData[this.rowCache[D].key].index=D}}else{for(var D=I,C=B;D<=C;D++){this.rowData[this.rowCache[D].key].index=D}for(var D=B,C=I;D<=C;D++){this.rowData[this.rowCache[D].key].index=D}}}if(has(this.activePos,A)){this.rowData[A].rowIndex=-1;I=this.activePos[A];delete this.activePos[A];this.activeId.splice(I,1);for(var D=0,C=this.activeId.length;D<C;D++){this.activePos[this.activeId[D]]=D}if(this.rowData[A].hidden){this.requiresRefresh=true}}if(!this.rowData[A].hidden){I=this.activeId.binarySearch(A,function(N,O){return(G.rowData[N].index.toFloat()-G.rowData[O].index.toFloat())*((G.options.reverse)?-1:1)});if(I<0){I=-(I+1)}this.activeId.splice(I,0,A);for(var D=I,C=this.activeId.length;D<C;D++){this.activePos[this.activeId[D]]=D}var E=this.getActiveRange();if((I>=E[0])&&(I<=E[1])){this.requiresRefresh=true;this.rowData[A].rowIndex=I-E[0]}}}else{if(!this.rowData[A].hidden&&!has(this.activePos,A)){this.activePos[A]=this.activeId.length;this.activeId.push(A);var E=this.getActiveRange();if((this.activePos[A]>=E[0])&&(this.activePos[A]<=E[1])){this.requiresRefresh=true}}else{if(this.rowData[A].hidden&&has(this.activePos,A)){var I=this.activePos[A];delete this.activePos[A];this.activeId.splice(I,1);for(var D=I,C=this.activeId.length;D<C;D++){this.activePos[this.activeId[D]]=D}this.requiresRefresh=true}}}if(this.options.mode==MODE_PAGE){this.pageCount=Math.ceil(this.activeId.length/this.options.maxRows)}},clearActive:function(){delete this.activePos;this.activePos={};this.activeId.length=0},requiresRefresh:false,fillRow:function(D,C,B){var A=this;this.colOrder.each(function(G,F){var E=D.childNodes[F];if(E.lastChild){if((G==0)&&B){E.addClasses("stable-icon",B,true)}E.lastChild.nodeValue=C[G]}else{if((G==0)&&B){E.addClasses("stable-icon",B,true)}E.appendText(C[G])}})},isDetached:false,detachBody:function(){if(this.isDetached){return }this.tb.body.dispose();this.isDetached=true},attachBody:function(){if(!this.isDetached){return }this.tBody.grab(this.tb.body);this.isDetached=false},removeRow:function(E){var C=this.rowData[E],D;if(C==null){return }if(D=$(E)){D.setProperty("id","")}if(has(this.activePos,E)){this.activeId.splice(this.activePos[E],1);for(var B=this.activePos[E],A=this.activeId.length;B<A;B++){this.activePos[this.activeId[B]]--}delete this.activePos[E]}if(has(this.rowSel,E)){this.selectedRows.splice(this.rowSel[E],1);for(var B=this.rowSel[E],A=this.selectedRows.length;B<A;B++){this.rowSel[this.selectedRows[B]]--}delete this.rowSel[E]}if(this.sIndex>=0){this.rowCache.splice(C.index,1);for(var B=C.index,A=this.rowCache.length;B<A;B++){this.rowData[this.rowCache[B].key].index=B}}C=null;this.requiresRefresh=true;delete this.rowData[E];this.rows--},clearRows:function(){if(this.rows>0){Array.each(this.tb.body.rows,function(A){Array.each(A.cells,function(B){B.empty()});A.setProperty("id","").hide()});delete this.activePos;this.activePos={};delete this.rowSel;this.rowSel={};delete this.rowData;this.rowData={};this.clearCache();this.rows=this.curPage=this.pageCount=this.activeId.length=this.selectedRows.length=this.viewRows=this.dBody.scrollLeft=this.dBody.scrollTop=0;this.updatePageMenu()}},calcSize:function(){this.dBody.setStyle("height",(this.dCont.clientHeight-this.dHead.offsetHeight-((this.options.mode==MODE_PAGE)?26:0)).max(52));this.dBody.setStyle("width",(this.dCont.offsetWidth-2).max(0));this.dHead.setStyle("width",(this.dCont.offsetWidth+(((this.dBody.offsetWidth-this.dBody.clientWidth)==0)?-4:-1)).max(0));if(!this.isResizing){for(var C=0,B=this.cols;C<B;C++){if(this.colData[C].disabled){continue}var A=0;if(Browser.Engine.trident&&(Browser.Engine.version<6)){A=this.tBodyCols[C].offsetWidth-19}else{A=this.tBodyCols[C].width-(Browser.Engine.webkit?0:19)}this.tHeadCols[C].setStyle("width",A.max(14))}}},hideRow:function(A){this.rowData[A].hidden=true;this.rowData[A].rowIndex=-1;this._insertRow(A,true)},unhideRow:function(A){this.rowData[A].hidden=false;this._insertRow(A,true)},refreshSelection:function(){if(!this.options.rowsSelectable){return }var A=this.tb.body.childNodes.length,C=0;while(C<A){var E=this.tb.body.childNodes[C];var D="",B=E.hasClass("selected");if(has(this.rowSel,E.id)){D+="selected";B=!B}if(this.options.alternateRows){if(C&1){D+=" odd";B=B|!E.hasClass("odd")}else{D+=" even";B=B|!E.hasClass("even")}}if(B){E.className=D.clean()}C++}this.pageInfo.set("text",this.selectedRows.length+" row(s) selected.")},clearSelection:function(A){if(this.selectedRows.length==0){return }this.selectedRows.length=0;delete this.rowSel;this.rowSel={};this.stSel=null;if(!A){this.refreshSelection()}},fillSelection:function(C){this.selectedRows=$A(this.activeId);for(var B=0,A=this.selectedRows.length;B<A;B++){this.rowSel[this.selectedRows[B]]=B}if(!C){this.refreshSelection()}},setValue:function(B,E,D){var J=this.rowData[B];if(J==null){return }var G=((this.sIndex>=0)&&(E==this.colOrder[this.sIndex]));var C=((J.data[E]!=D)&&G);J.data[E]=D;if(G){this._insertRow(B)}if(this.requiresRefresh||J.hidden||(J.rowIndex==-1)){return C}var A=this.tb.body.childNodes[J.rowIndex],F=this.colOrder.indexOf(E),I=A.childNodes[F],H=this.options.format([D],E)[0];if(I.lastChild){I.lastChild.nodeValue=H}else{I.appendText(H)}return C},setIcon:function(E,B){var D=this.rowData[E];D.icon=B;if(D.rowIndex==-1){return }var C=this.tb.body.childNodes[D.rowIndex],A=this.colOrder.indexOf(0);if(C.childNodes[A].hasClass(B)){return }C.childNodes[A].className="stable-icon "+B},resizeTo:function(A,B){if(typeof A=="number"){this.dCont.setStyle("width",A)}if(typeof B=="number"){this.dCont.setStyle("height",B)}this.calcSize()},colMenu:function(C){ContextMenu.clear();for(var A=0;A<this.cols;A++){var B=[this.colData[A].text,this.toggleColumn.bind(this,A)];if(!this.colData[A].disabled){B.splice(0,0,CMENU_CHECK)}ContextMenu.add(B)}ContextMenu.show(C)},toggleColumn:function(C){var F=!this.colData[C].disabled,H=this.colOrder[C],G=Browser.Engine.trident;this.colData[C].disabled=F;this.tBodyCols[C].setStyle("display",F?"none":"");this.tHeadCols[C].setStyle("display",F?"none":"");var A=G?"visibility":"display",E=F?(G?"hidden":"none"):(G?"visible":"");for(var D=0,B=this.tb.body.childNodes.length;D<B;D++){this.tb.body.childNodes[D].childNodes[C].setStyle(A,E)}this.fireEvent("onColToggle",[H,F]);this.calcSize();this.dHead.setStyle("width",this.dBody.clientWidth);this.dHead.scrollLeft=this.dBody.scrollLeft;return true},resizePads:function(){if(this.options.mode!=MODE_VIRTUAL){return }var F=this.options.maxRows;if(this.activeId.length<=F){this.topPad.setStyle("height",0);this.bottomPad.setStyle("height",0)}else{var D=this.dBody.clientHeight;var H=this.activeId.length*17;var C=this.dBody.scrollTop,E=this.dBody.scrollHeight;var A=((E-D)<=0)?0:(C/(E-D));if(A>1){A=1}var B=this.tBody.tBodies[0].offsetHeight;var G=(C+D>=H-B)?(H-B):(C-(B-D)*A);this.topPad.setStyle("height",G);this.bottomPad.setStyle("height",H-B-G)}},updatePageMenu:function(){if(this.options.mode!=MODE_PAGE){return }(this.curPage>0)?this.pagePrev.addClass("prevlink"):this.pagePrev.removeClass("prevlink").removeClass("prevlink-hover");(this.curPage<this.pageCount-1)?this.pageNext.addClass("nextlink"):this.pageNext.removeClass("nextlink").removeClass("nextlink-hover");this.pageSelect.options.length=0;if(this.pageCount<=1){this.pageSelect.disabled=true;return }this.pageSelect.disabled=false;for(var A=0;A<this.pageCount;A++){this.pageSelect.options[A]=new Option(A+1,A,false,A==this.curPage)}},gotoPage:function(C){if(this.curPage==C){return }var A=this.getActiveRange();for(var B=A[0];B<=A[1];B++){this.rowData[this.activeId[B]].rowIndex=-1}this.curPage=C;this.updatePageMenu();this.refreshRows()},prevPage:function(){if(this.curPage>0){this.gotoPage(this.curPage-1)}},nextPage:function(){if(this.curPage<this.pageCount-1){this.gotoPage(this.curPage+1)}}});var ColumnHandler={start:function initColAct(C,D){C.cancelSort=true;if(C.hotCell==-1){var E=D.element.getPosition(C.dCont).x+C.dBody.scrollLeft-(Browser.Engine.gecko19?4:0);D.value.now.x=E;D.mouse.pos.x=D.mouse.start.x-E;C.colDragObj.set("html",D.element.get("text")).setStyles({visibility:"visible",left:E,width:D.element.getStyle("width").toInt(),textAlign:D.element.getStyle("textAlign")});C.colDragEle=D.element;D.element=D.handle=C.colDragObj;C.cancelMove=false;C.colMove={from:C.colDragEle.retrieve("index"),to:-1};document.body.setStyle("cursor","move")}else{var B=C.tHeadCols[C.hotCell];var A=B.getSize().x;var E=B.getPosition(C.dCont).x+A-(Browser.Engine.gecko19?4:0);C.resizeCol={width:B.getStyle("width").toInt(),left:E};D.value.now.x=E;D.mouse.pos.x=D.mouse.start.x-E;C.cancelMove=true;C.isResizing=true;C.colReszObj.setStyles({left:E,height:C.dBody.getSize().y+2,visibility:"visible"});C.colDragEle=D.element;D.element=D.handle=C.colReszObj}},drag:function(D,F){if(!D.cancelMove){var B=0,E=0;var A=F.value.now.x;while((B<A)&&(E<=D.cols)){B+=D.tHeadCols[E].getWidth();E++}if(E>=D.cols){c=D.cols;D.colSep.setStyle("left",D.tHeadCols[c-1].offsetLeft+D.tHeadCols[c-1].getWidth()-1)}else{D.colSep.setStyle("left",D.tHeadCols[E].offsetLeft)}D.colSep.setStyle("visibility","visible");D.colMove.to=E;if(E==D.colMove.from){D.colMove.to++}}else{var C=F.value.now.x-D.resizeCol.left+D.resizeCol.width;if(C<14){C=14}D.tHeadCols[D.hotCell].setStyle("width",C);$(document.body).setStyle("cursor","e-resize")}},end:function(A,B){B.element=B.handle=A.colDragEle;A.colDragEle=null;if(A.isResizing){A.colReszObj.setStyles({left:0,height:0,visibility:"hidden"});A.isResizing=false;resizeColumn.call(A,A.hotCell);document.body.setStyle("cursor","default");A.rowCover.hide()}else{A.colDragObj.setStyles({left:0,width:0,visibility:"hidden"});A.colSep.setStyle("visibility","hidden");document.body.setStyle("cursor","default");moveColumn.call(A,A.colMove.from,A.colMove.to)}A.cancelSort=false},check:function(D,B){if(this.isResizing){return }var A=D.page.x-B.getPosition().x;var C=B.retrieve("index");if((A<=8)&&(C>0)){this.hotCell=C-1;B.setStyle("cursor","e-resize")}else{if(A>=B.offsetWidth-8){this.hotCell=C;B.setStyle("cursor","e-resize")}else{this.hotCell=-1;B.setStyle("cursor","default")}}}};function resizeColumn(B){var A=this.tHeadCols[B].offsetWidth;this.colWidth[this.colOrder[B]]=A;if(Browser.Engine.trident&&!Browser.Engine.trident6){A-=(B==0)?30:10}this.tBodyCols[B].setStyle("width",A).setProperty("width",A);A=this.tHead.getSize().x;this.tb.body.setStyle("width",A);this.tBody.setStyle("width",A);this.fireEvent("onColResize")}function moveColumn(B,I){if((I==-1)||(B==I-1)){return }var O,K,M,A,P,G,R;var C=(I==this.cols);var J=(I==0)||C;var D=(I<B);var F=(I>B);A=this.tHeadCols[B];M=A.parentNode;A.dispose();J?M.grab(A,C?"bottom":"top"):A.inject(this.tHeadCols[I],"before");M=this.tBody.getElement("colgroup");P=J?null:M.childNodes[I];A=M.childNodes[B].dispose();J?M.grab(A,C?"bottom":"top"):A.inject(P,"before");$each(this.tb.body.childNodes,function(U){var T=J?null:U.childNodes[I];var S=U.childNodes[B].dispose();J?U.grab(S,C?"bottom":"top"):S.inject(T,"before")});var N=[],L=[],H=[],E=[];A=this.tHeadCols[B];var Q=this.tBodyCols[B];for(O=0;O<this.cols;O++){if(O==B){continue}if(O==I){N.push(A);L.push(Q);H.push(this.colData[B]);E.push(this.colOrder[B])}N.push(this.tHeadCols[O]);L.push(this.tBodyCols[O]);H.push(this.colData[O]);E.push(this.colOrder[O])}if(I==this.cols){N.push(A);L.push(Q);H.push(this.colData[B]);E.push(this.colOrder[B])}this.tHeadCols=N;this.tBodyCols=L;this.colData=H;this.colOrder=E;for(O=0;O<this.cols;O++){this.tHeadCols[O].store("index",O)}if(B==this.sIndex){this.sIndex=I;if(I>B){this.sIndex--}}else{if((I<=this.sIndex)&&(I<B)){this.sIndex++}else{if((B<I)&&(this.sIndex<I)&&(this.sIndex>B)){this.sIndex--}}}this.cancelSort=false;this.fireEvent("onColMove")}var Comparator={compare:function(B,D){var C=""+B,A=""+D;return(C<A)?-1:(C>A)?1:0},compareNumeric:function(A,B){return(A.toFloat()-B.toFloat())},compareAlphaNumeric:function(B,D){var C=(""+B).toLowerCase(),A=(""+D).toLowerCase();return(C<A)?-1:(C>A)?1:0}};